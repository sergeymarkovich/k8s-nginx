# Задание 8 - Основы Kubernetes
## Условия задания
В Minikube:
1. Создать под nginx, который отвечает на url / "Cats and Dogs Review App";
2. Сделать deployment на 3 реплики с этим подом.
3. Сделать сервис ClusterIP для этого деплоймента.
4. Сделать Statefulset с двумя nginx серверами, которые по протоколу webdav будут отдавать первый
– текстовые обзоры на котиков, а второй – обзоры на песиков. Вместо webdav можно маленькое
stateful приложение.
6. Сделать Ingress, балансирующий на каждый шард по url /cats – на первый шард стейтфулсета,
/dogs – на второй.
7. Убрать конфиги всех nginx в Configmap.
8. Выставить лимиты и реквесты на поды
9. Сделать cronjob, которая делает curl на приложение и пишет в лог, что оно доступно.
10. Сделать readiness probe и liveness probe для контейнеров.

## Solution
### requirements 
- docker 
- minikube
- kubectl

### Для запуска проекта
- `sudo usermod -aG docker $USER && newgrp docker`
- ` minikube start using docker drivers`
- `minikube image load nginx`
- `kubectl create ns nginx`
- `minikube addons enable ingress`
- `kubectl apply -f state.yaml -n nginx`
- `kubectl apply -f deploy.yaml -n nginx`
- `./check_app.sh`

### Структура проекта 
1) `state.yaml` 

    **StatefulSet** определяет контроллер, который обеспечивает управление и масштабирование набора реплик приложения. В данном случае, установлено, что должно быть 2 реплики приложения Nginx. Контроллер отслеживает статус каждой реплики и обеспечивает их перезапуск при необходимости. Контейнер внутри StatefulSet использует образ Nginx, задает порт 80 для входящих соединений, определяет ресурсы (CPU и память) для контейнера, настраивает проверки готовности и жизнеспособности контейнера, а также монтирует томы для хранения конфигурации и данных.

    **Service** определяет точку доступа к приложению Nginx внутри кластера. В данном случае, создается сервис с типом ClusterIP, который пробрасывает порт 80 внутри кластера. Сервис также использует селектор для связывания с соответствующими подами StatefulSet.

    **ConfigMap** определяет конфигурацию Nginx, которая будет использоваться при развертывании приложения. Конфигурация определяет различные настройки для сервера Nginx, включая точки входа для различных URL-адресов и настройки доступа.

2) `deploy.yaml` 

    **Deployment**: Определяет развертывание контейнера Nginx. Указывает, какие контейнеры должны быть развернуты и каким образом их настроить. Включает в себя такие параметры, как имя развертывания, пространство имён, метаданные, селектор (для выбора подов, управляемых этим развертыванием), шаблон (описывает поды, создаваемые развертыванием) и другие параметры, такие как ресурсы и зонды для проверки доступности.

    **ConfigMap**: Содержит настройки Nginx в виде конфигурационного файла, который будет использоваться контейнером. ConfigMap хранит конфигурацию Nginx и предоставляет её как том контейнеру.

    **Service**: Определяет сервис, через который можно получить доступ к развернутому контейнеру Nginx. Указывает селектор, чтобы определить, к каким подам маршрутизировать запросы, и порт, на котором сервис будет слушать.

    **Ingress**: Определяет правила входящего трафика для приложения Nginx. Устанавливает соответствие между входящим путём и сервисом Nginx, чтобы запросы могли быть маршрутизированы к правильному сервису.